variants.per.chunk <- merged.sumstats %>% group_by(locus) %>% summarise(n = sum(CS))
hist(variants.per.chunk$n, xlab = 'Number of putative variants', main = 'Number of variants per CS', breaks = 50)
text(20, 10, paste('Median: ', round(median(variants.per.chunk$n),2)))
variants.per.chunk
variants.per.chunk %>% arrange(desc(n))
knitr::opts_chunk$set(echo = TRUE)
source('../trackplot.R')
source('../GWAS_funs_libs.R')
library(ggplot2)
library(kableExtra)
annotations <- c('Cancer_Drivers.bed','BRCA_OCRs.bed','Conserved_LindbladToh.bed','BRCA_ac.bed','Immune_OCRs.bed','Immune_h3k27ac.bed')
annotations <- paste0('~/GERMLINE/ANNOTATIONS/BRCA_run/',annotations)
locusPlotter(merged.sumstats, locus = 250, annotations = annotations)
pip_df <- data.frame(pip = merged.sumstats$susie_pip, pip_uniform = merged.sumstats.unif$susie_pip)
ggplot(pip_df, aes(x=pip_uniform, y=pip)) + geom_point() + geom_abline(slope = 1, color='red') + xlab('PIP (uniform)') + ylab('PIP')
load('../BRCA_susie_L1.Robj')
susie.rs <- susie_res
load('../BRCA_susie_L1_UNIFORM.Robj')
susie.res.unif <- susie_res
sumstats <- as_tibble(data.table::fread('../../SUMMARY_STATISTICS/BRCA_Sumstats_SuSiE_Ready.txt.gz', sep = '\t', header = T))
merged.sumstats <- merge_susie_sumstats(susie.res, sumstats)
load('../BRCA_susie_L1.Robj')
susie.rs <- susie_res
load('../BRCA_susie_L1_UNIFORM.Robj')
susie.res.unif <- susie_res
sumstats <- as_tibble(data.table::fread('../../SUMMARY_STATISTICS/BRCA_Sumstats_SuSiE_Ready.txt.gz', sep = '\t', header = T))
merged.sumstats <- merge_susie_sumstats(susie.res, sumstats)
load('../BRCA_susie_L1.Robj')
susie.res <- susie_res
load('../BRCA_susie_L1_UNIFORM.Robj')
susie.res.unif <- susie_res
sumstats <- as_tibble(data.table::fread('../../SUMMARY_STATISTICS/BRCA_Sumstats_SuSiE_Ready.txt.gz', sep = '\t', header = T))
merged.sumstats <- merge_susie_sumstats(susie.res, sumstats)
merged.sumstats.unif <- merge_susie_sumstats(susie.res.unif, sumstats)
variants.per.chunk <- merged.sumstats %>% group_by(locus) %>% summarise(n = sum(CS))
hist(variants.per.chunk$n, xlab = 'Number of putative variants', main = 'Number of variants per CS', breaks = 50)
text(20, 10, paste('Median: ', round(median(variants.per.chunk$n),2)))
pip_df <- data.frame(pip = merged.sumstats$susie_pip, pip_uniform = merged.sumstats.unif$susie_pip)
ggplot(pip_df, aes(x=pip_uniform, y=pip)) + geom_point() + geom_abline(slope = 1, color='red') + xlab('PIP (uniform)') + ylab('PIP')
variants.per.chunk %>% arange(desc(n))
variants.per.chunk %>% arrange(desc(n))
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annotations <- c('Cancer_Drivers.bed','BRCA_OCRs.bed','Conserved_LindbladToh.bed','BRCA_ac.bed','Immune_OCRs.bed','Immune_h3k27ac.bed')
annotations <- paste0('~/GERMLINE/ANNOTATIONS/BRCA_run/',annotations)
top.snps <- annotator(top.snps, annotations)
annot.names <- colnames(top.snps)[18:ncol(top.snps)]
for(i in 1:nrow(top.snps)){
x <- which(top.snps[i, annot.names] == 1)
if(length(x)>0){
clean.names <- sapply(strsplit(annot.names[x], split='[.]'), function(x){return(x[1])})
top.snps[i, 'category'] <- paste(clean.names,collapse = '\n')
}
else{
top.snps[i, 'category'] <- 'Other'
}
}
merged.sumstats
merged.sumstats.plot <- prune.regions(merged.sumstats)
bigsnp.1kg <- snp_attach(rdsfile = '~/GERMLINE/1000G/EUR_variable_1kg.rds')
merged.sumstats.plot <- prune.regions(merged.sumstats)
merged.sumstats.plot <- prune.regions(merged.sumstats, bigsnp.1kg)
merged.sumstats.plot
locusPlotter(merged.sumstats.plot, locus = 676, annotations)
locusPlotter(merged.sumstats.plot, locus = 105, annotations)
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annotations <- c('Cancer_Drivers.bed','BRCA_OCRs.bed','Conserved_LindbladToh.bed','BRCA_ac.bed','Immune_OCRs.bed','Immune_h3k27ac.bed')
annotations <- paste0('~/GERMLINE/ANNOTATIONS/BRCA_run/',annotations)
top.snps <- annotator(top.snps, annotations)
annot.names <- colnames(top.snps)[18:ncol(top.snps)]
for(i in 1:nrow(top.snps)){
x <- which(top.snps[i, annot.names] == 1)
if(length(x)>0){
clean.names <- sapply(strsplit(annot.names[x], split='[.]'), function(x){return(x[1])})
top.snps[i, 'category'] <- paste(clean.names,collapse = '\n')
}
else{
top.snps[i, 'category'] <- 'Other'
}
}
genes <- rtracklayer::import('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', format='bed')
genes <- rtracklayer::import('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', format='bed')
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
genes <- vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T)
top.snps <- add.nearby.gene(top.snps, genes)
genes
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
genes <- vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T)
top.snps <- add.nearby.gene(top.snps, genes)
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
genes <- vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T)
top.snps <- add.nearby.gene(top.snps, genes)
top.snps
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx/all_tissue_signif_pairs.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex)
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_genes','eGenes','Tissues','consequence','zscore','susie_pip', 'category', 'locus','CS')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes','eGenes','Tissues','Consequence','ZScore','PIP','Annotation', 'Locus', 'CS')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
unique(top.snps$locus)
top.snps.kable <- top.snps[ , c('snp', 'nearby_genes','eGenes','Tissues','consequence','zscore','susie_pip', 'category', 'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','eGenes','Tissues','Consequence','ZScore','PIP','Annotation', 'Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
# add drivers
drivers <- vroom::vroom('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.1_Slop100kb.bed', col_names = F)
drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
drivers
genes
genes[genes$gene %in% drivers, ]
genes[genes$gene %in% drivers, ]$gene
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
# add regular genes
genes <- vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T)
top.snps <- add.nearby.gene(top.snps, genes)
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000)
top.snps
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annotations <- c('Cancer_Drivers.bed','BRCA_OCRs.bed','Conserved_LindbladToh.bed','BRCA_ac.bed','Immune_OCRs.bed','Immune_h3k27ac.bed')
annotations <- paste0('~/GERMLINE/ANNOTATIONS/BRCA_run/',annotations)
top.snps <- annotator(top.snps, annotations)
annot.names <- colnames(top.snps)[18:ncol(top.snps)]
for(i in 1:nrow(top.snps)){
x <- which(top.snps[i, annot.names] == 1)
if(length(x)>0){
clean.names <- sapply(strsplit(annot.names[x], split='[.]'), function(x){return(x[1])})
top.snps[i, 'category'] <- paste(clean.names,collapse = '\n')
}
else{
top.snps[i, 'category'] <- 'Other'
}
}
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
# add regular genes
genes <- vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T)
top.snps <- add.nearby.gene(top.snps, genes)
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000)
top.snps
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annotations <- c('Cancer_Drivers.bed','BRCA_OCRs.bed','Conserved_LindbladToh.bed','BRCA_ac.bed','Immune_OCRs.bed','Immune_h3k27ac.bed')
annotations <- paste0('~/GERMLINE/ANNOTATIONS/BRCA_run/',annotations)
top.snps <- annotator(top.snps, annotations)
annot.names <- colnames(top.snps)[18:ncol(top.snps)]
for(i in 1:nrow(top.snps)){
x <- which(top.snps[i, annot.names] == 1)
if(length(x)>0){
clean.names <- sapply(strsplit(annot.names[x], split='[.]'), function(x){return(x[1])})
top.snps[i, 'category'] <- paste(clean.names,collapse = '\n')
}
else{
top.snps[i, 'category'] <- 'Other'
}
}
# add regular genes
genes <- vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T)
top.snps <- add.nearby.gene(top.snps, genes)
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000)
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx/all_tissue_signif_pairs.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex)
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_genes.x','nearby_genes.y','eGenes','Tissues','consequence','zscore','susie_pip', 'category', 'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','eGenes','Tissues','Consequence','ZScore','PIP','Annotation', 'Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
top.snps$category
annot.df <- vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T)
annot.df
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ] %>% select(-snp)
annot.df
annot.df <- vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T)
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ] %>% select(-snp)
annot.df <- vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T)
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df
categories <- colnames(annot.df)[-1]
categories
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ] select(-snp)
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ] %>% select(-snp)
lapply(annot.df, 1, FUN = function(x){which(x==1)})
lapply(annot.df, 1, FUN = function(x){return(which(x==1))})
sapply(annot.df, 1, FUN = function(x){return(which(x==1))})
sapply(annot.df, FUN = function(x){return(which(x==1))})
sapply(annot.df, MARGIN = 1, FUN = function(x){return(which(x==1))})
apply(annot.df, MARGIN = 1, FUN = function(x){return(which(x==1))})
apply(annot.df, MARGIN = 1, FUN = function(x){return(names(x)[which(x==1))]})
apply(annot.df, MARGIN = 1, FUN = function(x){return(names(x)[which(x==1)])})
apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df
apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
top.snps
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
top.snps
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx/all_tissue_signif_pairs.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex)
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','eGenes','Tissues','consequence','zscore','susie_pip', 'category', 'locus')]
top.snps
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx/all_tissue_signif_pairs.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex)
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','eGenes','Tissues','consequence','zscore','susie_pip', 'category', 'locus')]
top.snps
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','eGenes','Tissues','consequence','zscore','susie_pip', 'merged', 'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','eGenes','Tissues','Consequence','ZScore','PIP','Annotation', 'Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
View(pip_df)
id_name <- vroom::vroom('~/GERMLINE/refGenome/GENE_ID_NAME_b37.txt')
id_name <- vroom::vroom('~/GERMLINE/refGenome/GENE_ID_NAME_b37.txt', col_names = F)
id_name
colnames(id_name) <- c("id","name")
id_name
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood.txt',col_names = F)
wb
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood.txt',col_names = F, delim = '\t')
wb
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood.txt',col_names = F, delim = "")
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood.txt',col_names = F, delim = " ")
wb
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood.txt',col_names = F, delim = "\t")
wb
colnames(wb) <- c("chr","pos","a1","a2","id")
inner_join(id_name, wb, by="id")
id_name
wb
wb.join <- inner_join(wb, id, by="id")
wb.join <- inner_join(wb, id_name, by="id")
wb.join
vroom::vroom_write(wb.join, path = '../GTEx/Whole_Blood_var_gene.txt.gz', delim = '\t', col_names = T)
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_gene.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex)
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_gene.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_eqtl')
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_gene.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_eqtl')
top.snps
top.snps$whole_blood_eqtl
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_Tissue.txt.gz',col_names = F, delim = "\t")
colnames(wb) <- c("chr","pos","a1","a2","id")
wb
wb.join <- inner_join(wb, id_name, by="id")
wb.join
vroom::vroom_write(wb.join, path = '../GTEx_Analysis_v7_eQTL/Breast_Mammary_Tissue_var_gene.txt.gz', delim = '\t', col_names = T)
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_gene.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_Tissue_var_gene.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','whole_blood_gtex_eGenes','breast_gtex_eGenes','consequence','zscore','susie_pip', 'merged', 'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','Whole Blood eGenes','Breast eGenes','Consequence','ZScore','PIP','Annotation', 'Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood.txt',col_names = F, delim = "\t")
colnames(wb) <- c("chr","pos","a1","a2","gene_id")
wb
colnames(wb) <- c("chr","pos","a1","a2","id")
wb.join <- inner_join(wb, id_name, by="id")
wb.join
vroom::vroom_write(wb.join, path = '../GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t')
wb <- vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_Tissue.txt',col_names = F, delim = "\t")
colnames(wb) <- c("chr","pos","a1","a2","id")
wb.join <- inner_join(wb, id_name, by="id")
vroom::vroom_write(wb.join, path = '../GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t')
wb.join
wb
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','whole_blood_gtex_eGenes','breast_gtex_eGenes','consequence','zscore','susie_pip', 'merged', 'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','Whole Blood eGenes','Breast eGenes','Consequence','ZScore','PIP','Annotation', 'Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
top.snps <- replace_na(top.snps, replace = '_')
top.snps <- top.snps %>% replace_na(is.na(.), '_')
top.snps <- top.snps %>% replace_na(., '_')
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','whole_blood_gtex_eGenes','breast_gtex_eGenes','consequence','zscore','susie_pip', 'merged', 'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','Whole Blood eGenes','Breast eGenes','Consequence','ZScore','PIP','Annotation', 'Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
top.snps <- add.consequence(top.snps)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','breast_gtex_eGenes','whole_blood_gtex_eGenes','consequence','zscore','susie_pip', 'merged', 'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','Breast eGenes','Whole-Blood eGenes','Consequence','ZScore','PIP','Annotation', 'Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
write.table(top.snps.kable, file = '../BRCA/BRCA_finemapped_L1_pip0.1_annotated.txt', sep='\t', col.names = T, row.names = F, quote = F)
gwas <- vroom::vroom('../GWAS_catalog/gwas_catalog_v1.0-associations_e98_r2020-02-08.tsv',col_names = T)
gwas
gwas$SNPS
gwas[gwas$SNPS %in% top.snps, ]
gwas[gwas$SNPS %in% top.snps$snp, ]
gwas[gwas$SNPS %in% top.snps$snp, ]
gwas <- gwas[ , c('SNPS','DISEASE/TRAIT')]
colnames(gwas) <- c('snp','other_gwas_trait')
left_join(sumstats, gwas, by='snp')
left_join(merged.sumstats, gwas, by='snp')
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
top.snps <- add.consequence(top.snps)
gwas <- vroom::vroom('../GWAS_catalog/gwas_catalog_v1.0-associations_e98_r2020-02-08.tsv',col_names = T)
gwas <- vroom::vroom('../../GWAS_catalog/gwas_catalog_v1.0-associations_e98_r2020-02-08.tsv',col_names = T)
gwas <- gwas[ , c('SNPS','DISEASE/TRAIT')]
colnames(gwas) <- c('snp','other_gwas_trait')
top.snps <- left_join(top.snps, gwas, by='snp')
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','breast_gtex_eGenes','whole_blood_gtex_eGenes','consequence','zscore','susie_pip', 'merged','other_gwas_trait' ,'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','Breast eGenes','Whole-Blood eGenes','Consequence','ZScore','PIP','Annotation','GWAS Catalog','Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
top.snps
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
top.snps <- add.consequence(top.snps)
gwas <- suppressMessages(vroom::vroom('../../GWAS_catalog/gwas_catalog_v1.0-associations_e98_r2020-02-08.tsv',col_names = T))
add.gwas_catalog(top.snps, gwas)
gwas <- suppressMessages(vroom::vroom('../../GWAS_catalog/gwas_catalog_v1.0-associations_e98_r2020-02-08.tsv',col_names = T))
top.snps <- add.gwas_catalog(top.snps, gwas)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','breast_gtex_eGenes','whole_blood_gtex_eGenes','consequence','zscore','susie_pip', 'merged','gwas_catalog' ,'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','Breast eGenes','Whole-Blood eGenes','Consequence','ZScore','PIP','Annotation','GWAS Catalog','Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
gwas <- suppressMessages(vroom::vroom('../../GWAS_catalog/gwas_catalog_v1.0-associations_e98_r2020-02-08.tsv',col_names = T))
top.snps <- add.gwas_catalog(top.snps, gwas)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','breast_gtex_eGenes','whole_blood_gtex_eGenes','consequence','zscore','susie_pip', 'merged','gwas_catalog' ,'locus')]
top.snps
top.snps <- merged.sumstats[merged.sumstats$susie_pip > 0.1 & merged.sumstats$CS == 1, ]
annot.df <- suppressMessages(vroom::vroom('~/GERMLINE/SUMMARY_STATISTICS/torus/BRCA_Torus_annotations.txt.gz', col_names = T))
annot.df <- annot.df[annot.df$snp %in% top.snps$snp, ]
annot.df$merged <- apply(annot.df, MARGIN = 1, FUN = function(x){return(paste0(names(x)[which(x==1)], collapse = '\n'))})
top.snps <- inner_join(top.snps, annot.df[ ,c("snp","merged")], by = "snp")
# add regular genes
genes <- suppressMessages(vroom::vroom('~/GERMLINE/refGenome/GENES_COORDs_b37.txt', col_names = T))
top.snps <- add.nearby.gene(top.snps, genes, dist=10000, gene_type='nearby_gene')
# add drivers
drivers <- readLines('~/GERMLINE/ANNOTATIONS/cancer_driver_genes/AllDrivers_FDR_0.10.txt')
top.snps <- add.nearby.gene(top.snps, genes[genes$gene %in% drivers, ], dist = 100000, gene_type='nearby_driver')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Breast_Mammary_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'breast_gtex_eGenes')
gtex <- suppressMessages(vroom::vroom('~/GERMLINE/GTEx_Analysis_v7_eQTL/Whole_Blood_var_genes.txt.gz', col_names = T, delim = '\t'))
top.snps <- add.gtex.annotation(top.snps, gtex, tissue_type = 'whole_blood_gtex_eGenes')
top.snps <- add.consequence(top.snps)
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
gwas <- suppressMessages(vroom::vroom('../../GWAS_catalog/gwas_catalog_v1.0-associations_e98_r2020-02-08.tsv',col_names = T))
top.snps <- add.gwas_catalog(top.snps, gwas)
top.snps.kable <- top.snps[ , c('snp', 'nearby_gene','nearby_driver','breast_gtex_eGenes','whole_blood_gtex_eGenes','consequence','zscore','susie_pip', 'merged','gwas_catalog' ,'locus')]
colnames(top.snps.kable) <- c('SNP','Nearby Genes (10kb)','Nearby Drivers (100kb)','Breast eGenes','Whole-Blood eGenes','Consequence','ZScore','PIP','Annotation','GWAS Catalog','Locus')
top.snps.kable <- top.snps.kable[order(abs(top.snps.kable$PIP), decreasing = T), ]
kable(top.snps.kable) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
scroll_box(width = "100%", height = "600px")
colnames(annot.df)
source('~/GERMLINE/cancer-finemap/trackplot.R')
gc()
source('~/GERMLINE/cancer-finemap/trackplot.R')
source('~/GERMLINE/cancer-finemap/GWAS_funs_libs.R')
remove.packages("plotly")
